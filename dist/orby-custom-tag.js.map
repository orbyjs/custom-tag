{"version":3,"file":"orby-custom-tag.js","sources":["../src/index.js"],"sourcesContent":["import { h, render } from \"@orby/core\";\r\n\r\nlet CustomTags = {};\r\nlet CustomViews = {};\r\n\r\nexport default function register({ tag, props, children }) {\r\n    CustomViews[tag] = {\r\n        Component: children[0],\r\n        scoped: props.scoped,\r\n        props: props.props || []\r\n    };\r\n    if (!CustomTags[tag]) {\r\n        CustomTags[tag] = class extends HTMLElement {\r\n            constructor() {\r\n                super();\r\n                this.props = {};\r\n                if (CustomViews[tag].scoped) {\r\n                    this.attachShadow({ mode: \"open\" });\r\n                }\r\n            }\r\n            static get observedAttributes() {\r\n                return CustomViews[tag] ? CustomViews[tag].props : [];\r\n            }\r\n            connectedCallback() {\r\n                this.mounted = true;\r\n                this.mapAllProps();\r\n                this.update();\r\n            }\r\n            disconnectedCallback() {\r\n                this.update(true);\r\n            }\r\n            attributeChangedCallback(name, prev, next) {\r\n                if (prev === next) return;\r\n                this.props[name] = next;\r\n                this.update();\r\n            }\r\n            mapAllProps() {\r\n                let listProps = CustomViews[tag].props;\r\n                for (let i = 0; i < listProps.length; i++) {\r\n                    let index = listProps[i];\r\n                    this.props[index] = this.getAttribute(index);\r\n                }\r\n            }\r\n            update(dismount) {\r\n                if (!this.mounted) return;\r\n                if (this.prevent) return;\r\n                this.prevent = true;\r\n                setTimeout(() => {\r\n                    this.lastView = render(\r\n                        h(dismount ? \"\" : CustomViews[tag].Component, props),\r\n                        CustomViews[tag].scoped\r\n                            ? this.shadowRoot || this\r\n                            : this,\r\n                        this.lastView\r\n                    );\r\n                    this.prevent = false;\r\n                });\r\n            }\r\n        };\r\n        customElements.define(tag, CustomTags[tag]);\r\n    }\r\n    document.querySelectorAll(tag).forEach(element => element.update());\r\n}\r\n"],"names":["CustomTags","CustomViews","register","tag","props","children","Component","scoped","HTMLElement","constructor","attachShadow","mode","connectedCallback","mounted","mapAllProps","update","disconnectedCallback","attributeChangedCallback","name","prev","next","listProps","i","length","index","this","getAttribute","dismount","prevent","setTimeout","lastView","render","h","shadowRoot","customElements","define","document","querySelectorAll","forEach","element"],"mappings":"4CAEA,IAAIA,WAAa,GACbC,YAAc,GAElB,SAAwBC,UAASC,IAAEA,EAAFC,MAAOA,EAAPC,SAAcA,IAC3CJ,YAAYE,GAAO,CACfG,UAAWD,EAAS,GACpBE,OAAQH,EAAMG,OACdH,MAAOA,EAAMA,OAAS,IAErBJ,WAAWG,KACZH,WAAWG,GAAO,cAAcK,YAC5BC,2BAESL,MAAQ,GACTH,YAAYE,GAAKI,aACZG,aAAa,CAAEC,KAAM,gDAIvBV,YAAYE,GAAOF,YAAYE,GAAKC,MAAQ,GAEvDQ,yBACSC,SAAU,OACVC,mBACAC,SAETC,4BACSD,QAAO,GAEhBE,yBAAyBC,EAAMC,EAAMC,GAC7BD,IAASC,SACRhB,MAAMc,GAAQE,OACdL,UAETD,kBACQO,EAAYpB,YAAYE,GAAKC,UAC5B,IAAIkB,EAAI,EAAGA,EAAID,EAAUE,OAAQD,IAAK,KACnCE,EAAQH,EAAUC,QACjBlB,MAAMoB,GAASC,KAAKC,aAAaF,IAG9CT,OAAOY,GACEF,KAAKZ,UACNY,KAAKG,eACJA,SAAU,EACfC,WAAW,UACFC,SAAWC,YACZC,OAAEL,EAAW,GAAK1B,YAAYE,GAAKG,UAAWF,GAC9CH,YAAYE,GAAKI,QACXkB,KAAKQ,YACLR,KACNA,KAAKK,eAEJF,SAAU,QAI3BM,eAAeC,OAAOhC,EAAKH,WAAWG,KAE1CiC,SAASC,iBAAiBlC,GAAKmC,QAAQC,GAAWA,EAAQxB"}